pipeline {
    agent any
    stages {
        stage("Build") {
            steps {
                echo "Building using Maven"
            }
        }
        stage("Unit and Integration Tests") {
            steps {
                echo "Running unit tests with TestNG"
                echo "Running integration tests with Newman"
            }
            post {
                success {
                    emailext attachLog: true,
                    subject: "Completed both the tests",
                    body: "Completed both the tests",
                    to: "nihal.noor11@gmail.com"
                }
                failure {
                    emailext attachLog: true,
                    subject: "Failed both the tests",
                    body: "Failed both the tests",
                    to: "nihal.noor11@gmail.com"
                }
            }
        }
        stage("Code Analysis") {
            steps {
                echo "Analyzing code quality using Checkstyle"
            }
        }
        stage("Security Scan") {
            steps {
                echo "Performing security scan with Nikto"
            }
            post {
                success {
                    
                    subject: "Test Successfull",
                    body: "Test Successfull",
                    emailext attachLog: true,
                    to: "nihal.noor11@gmail.com"
                }
                failure {
                    
                    subject: "Test Failed",
                    body: "Test Failed",
                    emailext attachLog: true,
                    to: 'nihal.noor11@gmail.com'
                }
            }
        }
        stage("Deploy to Staging") {
            steps {
                echo "Deploying to Staging environment using Docker"
            }
        }
        stage("Integration Tests on Staging") {
            steps {
                echo "Running integration tests on Staging environment"
            }
        }
        stage("Deploy to Production") {
            steps {
                echo "Deploying to Production environment using Helm"
            }
        }
    }
    post {
        success {
            
            subject: "Pipeline success",
            emailext attachLog: true,
            body: "Pipeline creation successfully!",
            to: "nihal.noor11@gmail.com"
        }
        failure {
            emailext attachLog: true,
            subject: "Pipeline failed",
            body: "The pipeline failed",
            to: "nihal.noor11@gmail.com"
        }
    }
}
